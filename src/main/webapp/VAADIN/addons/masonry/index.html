<script src="js/thirdparty/jquery.min.js"></script>
<script src="js/thirdparty/masonry.pkgd.min.js"></script>
<script src="js/thirdparty/jquery.visible.js"></script>
<script src="js/thirdparty/imagesloaded.pkgd.min.js"></script>
<script src="js/thirdparty/jquery.lazyload.js"></script>
<script src="js/prototypes.js"></script>
<script src="js/masonry_connector.js"></script>

<link type="text/css" rel="stylesheet" href="css/hover.css">
<link type="text/css" rel="stylesheet" href="css/animate.css">
<link type="text/css" rel="stylesheet" href="css/styles.css">
<script>
$(document).ready(function() {

    var vaadinMasonry = window.com_github_lotsabackscatter_masonry_Masonry();
    
    vaadinMasonry.log = function(msg) { console.log(msg); };
    
    var page = 1;
    var perPage = 20;
    vaadinMasonry.loadMore = function() {
        console.log("Loading Page " + page);
        $.getJSON("https://api.flickr.com/services/rest/?method=flickr.photos.getRecent&format=json&jsoncallback=?&api_key=34536c8d197dd74c5cc51db8354b652d&extras=description,url_sq,url_l,geo,tags&per_page=" + perPage + "&page=" + page).success(jsonFlickrApi);
        page += 1;
    };
    
    var light_color = function () {
        return Math.random() * 6 < 5 ? 'white' : 'rgb(' + (Math.floor((256 - 229) * Math.random()) + 230) + ',' + (Math.floor((256 - 229) * Math.random()) + 230) + ',' + (Math.floor((256 - 229) * Math.random()) + 230) + ')';
    };    
    
    var jsonFlickrApi = function (data) {
        var cards = [];
        $.each(data.photos.photo, function (i, image) {
            var description;
            if (image.description._content) {
                description = image.description._content;
                if (image.tags) {
                    description += '<br><b>' + image.tags + '</b>';
                }
            } else {
                if (image.tags) {
                    description = '<b>' + image.tags + '</b>';
                }
            }

            var title;
            if (description) {
                title = image.title;
            } else {
                description = image.title;
            }

            cards.push(vaadinMasonry.addCard(title, title, description, image.url_l, light_color()));
        });
        
        vaadinMasonry.onLoadComplete();
    };

    vaadinMasonry.loadMore();
});
</script>
<body>
<div id="blueimp-gallery" class="blueimp-gallery blueimp-gallery-controls">
    <div class="slides"></div>
    <h3 class="title"></h3>
    <a class="prev">‹</a>
    <a class="next">›</a>
    <a class="close">×</a>
    <a class="play-pause"></a>
    <ol class="indicator"></ol>
</div>
</body>